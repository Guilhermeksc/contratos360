<div class="diario-oficial-container">
  <!-- Cabeçalho Padronizado -->
  <app-page-header
    title="Diário Oficial da União - Imprensa Nacional"
    iconPath="assets/img/svg/dou.svg"
    [showThemeToggle]="true"
    [isDarkTheme]="isDarkTheme()"
    (themeToggle)="onThemeToggle($event)">
    
    <!-- Controles do header (filtros, etc.) -->
    <div headerControls>
      <input 
        type="text" 
        class="uasg-input-inline search-input"
        [value]="searchTerm()"
        (input)="searchTerm.set($any($event.target).value); onSearchChange()"
        placeholder="UASG, tipo, publicação..."
      />

      <div class="date-input-wrapper">
        <input 
          type="text"
          class="uasg-input-inline date-input"
          [value]="dateInputValue()"
          readonly
          placeholder="Data da Publicação"
          [matDatepicker]="picker"
          #dateInput
          (focus)="picker.open()"
          (dateInput)="onDateInput($event)"
          (dateChange)="onDateChange($event)"
        />
        <button 
          type="button"
          class="date-picker-button"
          (click)="dateInput.focus()"
          [matTooltip]="'Selecionar data'">
          <mat-icon>calendar_today</mat-icon>
        </button>
        <mat-datepicker 
          #picker
          xPosition="start"
          yPosition="below"
          (closed)="onDatepickerClosed()"
          (opened)="onDatepickerOpened()">
        </mat-datepicker>
      </div>

      <button 
        class="action-button-inline secondary"
        (click)="clearFilters()">
        <mat-icon>clear</mat-icon>
        <span>Limpar Filtros</span>
      </button>
    </div>
    
    <!-- Conteúdo abaixo do header (tabela, etc.) -->
    <div headerContent>
      <!-- Loading -->
      <div *ngIf="loading()" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Carregando artigos...</p>
      </div>

      <!-- Tabela -->
      <div *ngIf="!loading()" class="table-card">
        <app-standard-table [isDarkTheme]="isDarkTheme()" [showBorder]="false">
          <table mat-table [dataSource]="dataSource" class="articles-table">
        <!-- Data da Publicação -->
        <ng-container matColumnDef="pub_date">
          <th mat-header-cell *matHeaderCellDef>Data da Publicação</th>
          <td mat-cell *matCellDef="let article">
            <div class="date-cell">
              <mat-icon class="date-icon">calendar_today</mat-icon>
              <span>{{ formatDisplayDate(article.pub_date) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- UASG -->
        <ng-container matColumnDef="uasg">
          <th mat-header-cell *matHeaderCellDef>UASG</th>
          <td mat-cell *matCellDef="let article" class="uasg-cell">
            <div class="uasg-content">
              <div class="uasg-number">{{ article.uasg || 'N/A' }}</div>
              <div *ngIf="article.om_name" class="om-name">
                ({{ article.om_name }})
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Tipo -->
        <ng-container matColumnDef="art_type">
          <th mat-header-cell *matHeaderCellDef>Tipo</th>
          <td mat-cell *matCellDef="let article">{{ article.art_type || 'N/A' }}</td>
        </ng-container>

        <!-- Objeto -->
        <ng-container matColumnDef="objeto">
          <th mat-header-cell *matHeaderCellDef>Objeto</th>
          <td mat-cell *matCellDef="let article" class="objeto-cell">
            <span *ngIf="article.aviso_licitacao?.objeto" [matTooltip]="article.aviso_licitacao.objeto">
              {{ article.aviso_licitacao.objeto }}
            </span>
            <span *ngIf="article.credenciamento?.objeto && !article.aviso_licitacao?.objeto" [matTooltip]="article.credenciamento.objeto">
              {{ article.credenciamento.objeto }}
            </span>
            <span *ngIf="!article.aviso_licitacao?.objeto && !article.credenciamento?.objeto" class="no-objeto">-</span>
          </td>
        </ng-container>

        <!-- PDF -->
        <ng-container matColumnDef="pdf_page">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let article" class="actions-cell">
            <button 
              *ngIf="article.pdf_page"
              class="pdf-icon-button"
              (click)="openPdf(article.pdf_page)"
              [matTooltip]="'Abrir PDF'"
              [matTooltipPosition]="'above'">
              <mat-icon>picture_as_pdf</mat-icon>
            </button>
            <span *ngIf="!article.pdf_page" class="no-pdf">-</span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

        <!-- Mensagem quando não há dados -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">
            <div class="no-data">
              <mat-icon>info</mat-icon>
              <p>Nenhum artigo encontrado</p>
            </div>
          </td>
        </tr>
      </table>
        </app-standard-table>

      <!-- Paginação -->
      <mat-paginator
        [length]="totalCount()"
        [pageSize]="pageSize"
        [pageIndex]="pageIndex"
        [pageSizeOptions]="pageSizeOptions"
        [showFirstLastButtons]="true"
        (page)="onPageChange($event)">
      </mat-paginator>
      </div>

      <!-- Informações -->
      <div *ngIf="!loading() && articles().length > 0" class="info-card">
        <div class="info-content">
          <mat-icon>info</mat-icon>
          <div>
            <p><strong>Total de artigos encontrados:</strong> {{ totalCount() }}</p>
            <p class="info-note">
              Os artigos são filtrados automaticamente pelo termo "Comando da Marinha" na categoria.
              Clique no ícone de PDF para visualizar a publicação completa no portal da Imprensa Nacional.
            </p>
          </div>
        </div>
      </div>
    </div>
  </app-page-header>
</div>
