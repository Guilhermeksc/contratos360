// ============================================
// Angular Material Overrides - Dracula Theme
// ============================================

@use './variables' as *;
@use './mixins' as *;

// Mat Table
::ng-deep .mat-mdc-table {
  background-color: $bg-secondary;
  color: $text-primary;
}

::ng-deep .mat-mdc-header-row {
  background-color: $bg-tertiary;
}

::ng-deep .mat-mdc-row {
  &:hover {
    background-color: $bg-hover;
  }
}

// Mat Form Field
::ng-deep .mat-mdc-form-field {
  .mat-mdc-text-field-wrapper {
    background-color: $bg-secondary;
  }
  
  .mat-mdc-form-field-input-control {
    color: $text-primary;
  }
  
  .mat-mdc-form-field-label {
    color: $text-secondary;
  }
  
  &.mat-focused {
    .mat-mdc-form-field-label {
      color: $blue;
    }
  }
}

// Mat Button
::ng-deep .mat-mdc-button,
::ng-deep .mat-mdc-raised-button,
::ng-deep .mat-mdc-outlined-button {
  &.mat-primary {
    background-color: $blue;
    color: $bg-primary;
    
    &:hover {
      background-color: $blue-dark;
    }
  }
}

// Mat Menu
::ng-deep .mat-mdc-menu-panel {
  background-color: $bg-secondary;
  border: $border-width solid $border-color;
  border-radius: $border-radius-md;
}

::ng-deep .mat-mdc-menu-item {
  color: $text-primary;
  
  &:hover {
    background-color: $bg-hover;
  }
  
  mat-icon {
    color: $text-secondary;
  }
}

// Mat Tabs
::ng-deep .mat-mdc-tab-group {
  .mat-mdc-tab-header {
    background-color: $bg-secondary;
    border-bottom: $border-width solid $border-color;
  }
  
  .mat-mdc-tab {
    color: $text-secondary;
    
    &.mdc-tab--active {
      color: $blue;
    }
  }
  
  .mdc-tab-indicator__content--underline {
    border-color: $blue;
  }
}

// Mat Paginator
::ng-deep .mat-mdc-paginator {
  background-color: $bg-secondary;
  color: $text-primary;
  border-top: $border-width solid $border-color;
  
  .mat-mdc-paginator-page-size-label,
  .mat-mdc-paginator-range-label {
    color: $text-secondary;
  }
  
  .mat-mdc-icon-button {
    color: $text-secondary;
    
    &:hover {
      color: $text-primary;
    }
  }
}

// Mat Tooltip
::ng-deep .mat-mdc-tooltip {
  background-color: $bg-tertiary;
  color: $text-primary;
  font-size: $font-size-xs;
  padding: $spacing-xs $spacing-sm;
  border: $border-width solid $border-color;
}

// Mat Dialog
::ng-deep .cdk-overlay-backdrop {
  background-color: rgba(0, 0, 0, 0.85) !important;
  backdrop-filter: blur(6px) !important;
  -webkit-backdrop-filter: blur(6px) !important;
  z-index: 10001 !important; // Acima do popup de registro (z-index: 10000)
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100% !important;
  height: 100% !important;
}

::ng-deep .cdk-overlay-container {
  z-index: 10001 !important;
}

::ng-deep .cdk-overlay-pane {
  z-index: 10002 !important;
}

// Quando o diálogo estiver aberto, desfoca o popup de registro
// O backdrop tem z-index maior, então aplicamos blur diretamente no popup
::ng-deep body:has(.cdk-overlay-backdrop.cdk-overlay-backdrop-showing) .janela-overlay {
  filter: blur(6px) !important;
  opacity: 0.5 !important;
  transition: filter 0.3s ease, opacity 0.3s ease;
  pointer-events: none !important;
  
  .janela-content {
    pointer-events: auto;
  }
}

// Fallback para navegadores que não suportam :has()
::ng-deep .cdk-overlay-backdrop.cdk-overlay-backdrop-showing ~ * .janela-overlay {
  filter: blur(6px) !important;
  opacity: 0.5 !important;
  transition: filter 0.3s ease, opacity 0.3s ease;
  pointer-events: none !important;
  
  .janela-content {
    pointer-events: auto;
  }
}

::ng-deep .mat-mdc-dialog-container {
  background-color: $bg-primary !important;
  color: $text-primary;
  border: 2px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: $border-radius-md;
  padding-top: $spacing-xxl * 3;
  padding-bottom: $spacing-xxl;
  padding-left: $spacing-xxl;
  padding-right: $spacing-xxl;
  margin-top: $spacing-xxl * 2;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  z-index: 10002 !important;
  
  .mdc-dialog__surface {
    background-color: $bg-primary !important;
    border: 2px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: $border-radius-md;
  }
}

::ng-deep .mdc-dialog__surface {
  background-color: $bg-primary !important;
  border: 2px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: $border-radius-md;
}

::ng-deep .mat-mdc-dialog-title {
  color: $text-primary;
  font-size: $font-size-xl;
  font-weight: $font-weight-semibold;
  margin-bottom: 0;
  
  // Permite que o título seja parte do header customizado
  &.dialog-header-title {
    margin: 0;
  }
}

::ng-deep .mat-mdc-dialog-content {
  color: $text-secondary;
  font-size: $font-size-base;
  line-height: 1.5;
  padding: 0;
  margin: 0;
}

::ng-deep .mat-mdc-dialog-actions {
  margin-top: $spacing-xxl;
  padding: 0;
  min-height: auto;
  
  button {
    margin-left: $spacing-md;
    
    &:first-child {
      margin-left: 0;
    }
  }
}

// Mat Snackbar
::ng-deep .mat-mdc-snack-bar-container {
  background-color: $bg-secondary !important;
  color: $text-primary !important;
  border: $border-width solid $border-color !important;
  border-radius: $border-radius-md !important;
  
  &.success-snackbar {
    background-color: rgba($green, 0.2) !important;
    border-color: $green !important;
    color: $green !important;
  }
  
  &.error-snackbar {
    background-color: rgba($red, 0.2) !important;
    border-color: $red !important;
    color: $red !important;
  }
  
  .mat-mdc-snack-bar-label {
    color: inherit !important;
  }
  
  .mat-mdc-button {
    color: inherit !important;
  }
}

// Mat Datepicker - Fundo branco para calendários com máxima especificidade
// Usando body para aumentar especificidade e sobrescrever qualquer estilo global
::ng-deep body .cdk-overlay-container .mat-datepicker-content,
::ng-deep body .cdk-overlay-container .mat-datepicker-popup,
::ng-deep body .cdk-overlay-pane .mat-datepicker-content,
::ng-deep body .cdk-overlay-pane .mat-datepicker-popup {
  background-color: #ffffff !important;
  background: #ffffff !important;
  background-image: none !important;
  border: 1px solid #e0e0e0 !important;
  border-radius: 4px !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

::ng-deep body .cdk-overlay-container .mat-calendar,
::ng-deep body .cdk-overlay-pane .mat-calendar,
::ng-deep body .mat-datepicker-content .mat-calendar,
::ng-deep body .mat-datepicker-popup .mat-calendar {
  background-color: #ffffff !important;
  background: #ffffff !important;
  background-image: none !important;
  color: #333333 !important;
}

::ng-deep body .cdk-overlay-container .mat-calendar-table,
::ng-deep body .cdk-overlay-pane .mat-calendar-table,
::ng-deep body .mat-calendar .mat-calendar-table {
  background-color: #ffffff !important;
  background: #ffffff !important;
  background-image: none !important;
}

::ng-deep body .cdk-overlay-container .mat-calendar-body,
::ng-deep body .cdk-overlay-pane .mat-calendar-body,
::ng-deep body .mat-calendar .mat-calendar-body {
  background-color: #ffffff !important;
  background: #ffffff !important;
  background-image: none !important;
}

::ng-deep body .cdk-overlay-container .mat-calendar-header,
::ng-deep body .cdk-overlay-pane .mat-calendar-header,
::ng-deep body .mat-calendar .mat-calendar-header {
  background-color: #ffffff !important;
  background: #ffffff !important;
  background-image: none !important;
  color: #333333 !important;
}

::ng-deep body .cdk-overlay-container .mat-calendar-table-header,
::ng-deep body .cdk-overlay-pane .mat-calendar-table-header,
::ng-deep body .mat-calendar .mat-calendar-table-header {
  background-color: #ffffff !important;
  background: #ffffff !important;
  background-image: none !important;
  color: #333333 !important;
}

::ng-deep body .mat-calendar-table-header th,
::ng-deep body .mat-calendar .mat-calendar-table-header th {
  background-color: #ffffff !important;
  background: #ffffff !important;
  background-image: none !important;
  color: #333333 !important;
}

::ng-deep body .mat-calendar-body-cell-content {
  color: #212121 !important;
}

::ng-deep body .mat-calendar-body-selected .mat-calendar-body-cell-content {
  color: #ffffff !important;
}

::ng-deep body .mat-calendar-body-today .mat-calendar-body-cell-content {
  color: #1976d2 !important;
  font-weight: 600 !important;
}

::ng-deep body .mat-calendar-body-cell:hover .mat-calendar-body-cell-content {
  color: #212121 !important;
}

::ng-deep body .mat-calendar-period-button {
  color: #212121 !important;
  border-radius: 4px !important;
  transition: all 0.2s ease !important;
  
  &:hover {
    background-color: #f5f5f5 !important;
    border-radius: 4px !important;
  }
}

::ng-deep body .mat-calendar-previous-button,
::ng-deep body .mat-calendar-next-button {
  color: #212121 !important;
}

::ng-deep body .mat-calendar-table-header th {
  color: #212121 !important;
  font-weight: 600 !important;
}

// Forçar fundo branco mesmo em elementos com estilos inline
::ng-deep body .mat-datepicker-content,
::ng-deep body .mat-datepicker-popup,
::ng-deep body .mat-calendar {
  &[style*="background"] {
    background-color: #ffffff !important;
    background: #ffffff !important;
  }
}

